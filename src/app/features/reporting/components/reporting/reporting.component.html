<mat-tab-group color="accent">
  <!--CPI reporting-->
  <mat-tab>
    <ng-template mat-tab-label>
      <mat-icon>leaderboard</mat-icon>
      <span class="ml-2">Aggregate Performance</span>
    </ng-template>
    <div class="reporting__loading-shade" *ngIf="isLoadingResults">
      <mat-spinner color="accent" *ngIf="isLoadingResults"></mat-spinner>
    </div>
    <div class="mat-elevation-z8 mt-2 reporting-component__table-container">
      <div class="d-flex justify-content-start col-12 flex-wrap">
        <mat-form-field class="mr-4">
          <mat-label>start date</mat-label>
          <input
            matInput
            [formControl]="startPickerInputControl"
            [matDatepicker]="startpicker"
          />
          <mat-datepicker-toggle
            matSuffix
            [for]="startpicker"
          ></mat-datepicker-toggle>
          <mat-datepicker #startpicker></mat-datepicker>
        </mat-form-field>

        <mat-form-field class="mr-4">
          <mat-label>end date</mat-label>
          <input
            matInput
            [formControl]="endPickerInputControl"
            [matDatepicker]="endpicker"
          />
          <mat-datepicker-toggle
            matSuffix
            [for]="endpicker"
          ></mat-datepicker-toggle>
          <mat-datepicker #endpicker></mat-datepicker>
        </mat-form-field>

        <div>
          <button
            [disabled]="filterByDateDisabled()"
            mat-icon-button
            class="reporting__buttons"
            (click)="filterByDate()"
            mat-icon-button
          >
            <mat-icon aria-label="save">filter_alt</mat-icon>
            filter by date
          </button>
        </div>

        <div>
          <button
            mat-icon-button
            class="reporting__buttons"
            (click)="resetDateForms()"
            mat-icon-button
          >
            <mat-icon aria-label="clear">clear</mat-icon>
            clear filters
          </button>
        </div>

        <div>
          <button
            (click)="downloadAggregateCsv()"
            mat-icon-button
            class="reporting__buttons ml-2"
            mat-icon-button
          >
            <mat-icon class="ml-2" aria-label="download">save_alt</mat-icon>
            csv download
          </button>
        </div>

        <div>
          <button
            mat-icon-button
            class="reporting__buttons"
            (click)="showAggregateDataView()"
            *ngIf="!isAggregateDataVisMode"
            mat-icon-button
          >
            <mat-icon class="ml-2" aria-label="download">show_chart</mat-icon>
            visualization
          </button>

          <button
            mat-icon-button
            class="reporting__buttons"
            (click)="showAggregateTableView()"
            *ngIf="isAggregateDataVisMode"
            mat-icon-button
          >
            <mat-icon class="ml-2" aria-label="download">table_view</mat-icon>
            table
          </button>
        </div>
      </div>

      <!-- data view -->
      <div *ngIf="isAggregateDataVisMode">
        <div>
          <mat-chip-list>
            <mat-chip
              *ngFor="
                let activeLineChartLabel of reportingService.activeLineChartLabel$.getValue()
              "
              [selected]="activeLineChartLabel.state"
              (click)="onChipClicked(activeLineChartLabel)"
            >
              {{ activeLineChartLabel.name }}
            </mat-chip>
          </mat-chip-list>
        </div>
        <app-line-chart></app-line-chart>
      </div>

      <!-- normal view -->
      <mat-paginator
        [ngClass]="isAggregateDataVisMode ? 'd-none' : ''"
        #aggregatePaginator
        [pageSizeOptions]="[25, 50, 100, 365]"
        showFirstLastButtons
        class="reporting__paginator"
      >
      </mat-paginator>

      <table
        [ngClass]="isAggregateDataVisMode ? 'd-none' : ''"
        mat-table
        [dataSource]="dataSource"
        matSort
        matSortActive="timestamp"
        matSortDirection="asc"
      >
        <ng-container matColumnDef="timestamp">
          <th mat-header-cell mat-sort-header *matHeaderCellDef>
            Date
          </th>
          <td mat-cell *matCellDef="let element">{{ element.timestamp }}</td>
        </ng-container>

        <ng-container matColumnDef="spend">
          <th mat-header-cell mat-sort-header *matHeaderCellDef>
            Cost
          </th>
          <td mat-cell *matCellDef="let element">{{ element.spend }}</td>
        </ng-container>

        <ng-container matColumnDef="installs">
          <th mat-header-cell mat-sort-header *matHeaderCellDef>
            Installs
          </th>
          <td mat-cell *matCellDef="let element">{{ element.installs }}</td>
        </ng-container>

        <ng-container matColumnDef="cpi">
          <th mat-header-cell mat-sort-header *matHeaderCellDef>
            Cost Per Install
          </th>
          <td mat-cell *matCellDef="let element">{{ element.cpi }}</td>
        </ng-container>

        <ng-container matColumnDef="purchases">
          <th mat-header-cell mat-sort-header *matHeaderCellDef>
            Purchases
          </th>
          <td mat-cell *matCellDef="let element">{{ element.purchases }}</td>
        </ng-container>

        <ng-container matColumnDef="revenue">
          <th mat-header-cell mat-sort-header *matHeaderCellDef>
            Revenue
          </th>
          <td mat-cell *matCellDef="let element">{{ element.revenue }}</td>
        </ng-container>

        <ng-container matColumnDef="cpp">
          <th mat-header-cell mat-sort-header *matHeaderCellDef>
            Cost Per Purchase
          </th>
          <td mat-cell *matCellDef="let element">{{ element.cpp }}</td>
        </ng-container>

        <ng-container matColumnDef="revenueOverCost">
          <th mat-header-cell mat-sort-header *matHeaderCellDef>
            Return On Ad Spend
          </th>
          <td mat-cell *matCellDef="let element">
            {{ element.revenueOverCost }}
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      </table>
    </div>
  </mat-tab>
  <!--Keywords reporting-->
  <mat-tab>
    <ng-template mat-tab-label>
      <mat-icon>insights</mat-icon><span class="ml-2">Keyword Performance</span>
    </ng-template>
    <div
      class="reporting__loading-shade"
      *ngIf="reportingService.isLoadingKeywords"
    >
      <mat-spinner
        color="accent"
        *ngIf="reportingService.isLoadingKeywords"
      ></mat-spinner>
    </div>
    <app-keyword-reporting></app-keyword-reporting>
  </mat-tab>
</mat-tab-group>
